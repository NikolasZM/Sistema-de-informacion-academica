{% extends "base_docente.html" %}
{% block title %}Asistencia de Estudiantes{% endblock %}

{% block content %}
<h2 style="color:#1976d2; margin-bottom:18px; padding-bottom:6px; border-bottom:2px solid #e3eafc;">
  Carga Académica - Asistencia
</h2>

<!-- Selector de periodo (usa periodos y periodo_seleccionado pasados desde routes.py) -->
<div style="margin-bottom:14px;">
  <form id="periodoFormAsis" method="get" action="{{ url_for('routes.asistencia_docente') }}" style="display:inline;">
    <label for="periodo" style="font-weight:600; margin-right:8px;">Período:</label>
    <select name="periodo" id="periodo" onchange="document.getElementById('periodoFormAsis').submit()" style="padding:6px;border-radius:6px;border:1px solid #ccc;">
      {% if periodos %}
        {% for p in periodos %}
          <option value="{{ p.id }}" {% if periodo_seleccionado == p.id %}selected{% endif %}>{{ p.codigo }}</option>
        {% endfor %}
      {% else %}
        <option>N/A</option>
      {% endif %}
    </select>
  </form>
</div>

<div style="background:#fff; border-radius:12px; box-shadow:0 3px 10px rgba(0,0,0,0.05); padding:22px;">
  <table style="width:100%; border-collapse:collapse;">
    <tr style="background:#1976d2; color:#fff;">
      <th style="padding:8px;">Código</th>
      <th style="padding:8px;">Nombre</th>
      <th style="padding:8px;">Módulo</th>
      <th style="padding:8px;">No. Módulo</th>
      <th style="padding:8px;">Periodo</th>
      <th style="padding:8px;">Sección</th>
      <th style="padding:8px;">Asistencia</th>
      <th style="padding:8px;">Justificación</th>
      <th style="padding:8px;">Reporte</th>
      <th style="padding:8px;">Plantilla</th>
    </tr>
    {% for carga in cargas %}
    <tr style="background:{{ '#f9fafb' if loop.index0 % 2 == 0 else '#fff' }};">
      <td style="padding:8px;">{{ carga.codigo }}</td>
      <td style="padding:8px;">{{ carga.nombre }}</td>
      <td style="padding:8px;">{{ carga.modulo or '' }}</td>
      <td style="padding:8px;">{{ carga.modulo_num or '' }}</td>
      <td style="padding:8px;">{{ carga.periodo }}</td>
      <td style="padding:8px;">{{ carga.salon }}</td>
      <td style="padding:8px;">
        <a href="{{ url_for('routes.registrar_asistencia', codigo=carga.codigo, periodo=periodo_seleccionado) }}">
          <button style="background:#29b6f6; color:#fff; border:none; border-radius:6px; padding:7px 14px; font-weight:600; cursor:pointer;">
            Registrar
          </button>
        </a>
      </td>
      <td style="padding:8px;">
        <a href="{{ url_for('routes.registrar_justificacion', codigo=carga.codigo, periodo=periodo_seleccionado) }}">
          <button style="background:#ffd600; color:#333; border:none; border-radius:6px; padding:7px 14px; font-weight:600; cursor:pointer;">
            Justificación
          </button>
        </a>
      </td>
      <td style="padding:8px;">
        <a href="{{ url_for('routes.reporte_asistencia', codigo=carga.codigo, periodo=periodo_seleccionado) }}" target="_blank">
          <button style="background:#ef5350; color:#fff; border:none; border-radius:6px; padding:7px 14px; font-weight:600; cursor:pointer;">
            Reporte
          </button>
        </a>
      </td>
      <td style="padding:8px;">
        <a href="{{ url_for('routes.reporte_asistencia_pdf_inline', codigo=carga.codigo, periodo=periodo_seleccionado) }}" target="_blank" rel="noopener">
          <button style="background:#66bb6a; color:#fff; border:none; border-radius:6px; padding:7px 14px; font-weight:600; cursor:pointer;">
            Plantilla
          </button>
        </a>
      </td>
    </tr>
    {% endfor %}
  </table>
  <div style="margin-top:12px; color:#607d8b; font-size:0.9em;">
    Mostrando registros del 1 al {{ cargas|length }} de un total de {{ cargas|length }} registros
  </div>
</div>
{% endblock %}